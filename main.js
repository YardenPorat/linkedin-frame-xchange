(()=>{"use strict";const t=t=>document.querySelector(t),e=t("#image-input"),o=t("#image-vertical-offset"),a=t("#image-horizontal-offset"),n=t("body"),l=t("canvas"),r=t("#download-button"),i={textOffset:t("input#text-offset"),text:t("input#text"),textColor:t("input#text-color"),frameColor1:t("input#frame-color-1"),frameColor2:t("input#frame-color-2"),scale:t("#image-scale"),labelBackground:t("#label-background")},s=500,c=210;l.width=s,l.height=s;const u=l.getContext("2d");u.font="bold 60px Open Sans, sans-serif",u.textAlign="center",u.textBaseline="middle";const d=new Image;d.setAttribute("crossorigin","anonymous"),d.src="https://raw.githubusercontent.com/YardenPorat/static-files/main/suit-guy-avatar.png",d.onload=()=>{!function(){const t=100/(Math.min(d.height,d.width)/s);i.scale.value=t.toFixed(2),o.value=((d.height*t/100-s)/-2).toFixed(2),a.value=((d.width*t/100-s)/-2).toFixed(2)}(),h()};const f=t=>Math.round(255*t).toString(16),m=t=>/[\u0590-\u05FF]/.test(t);function h(){const t=i.scale.value/100,e=c;u.drawImage(d,a.value,o.value,d.width*t,d.height*t),function(t){const e=u.createLinearGradient(0,s-t,s/2,s/2-t);e.addColorStop(0,i.frameColor1.value+f(1)),e.addColorStop(.15,i.frameColor1.value+f(1)),e.addColorStop(.8,i.frameColor2.value+f(1)),e.addColorStop(.9,i.frameColor2.value+f(.4)),e.addColorStop(.95,i.frameColor2.value+f(.1)),e.addColorStop(1,"rgba(0,0,0,0"),u.fillStyle=e,u.fillRect(0,s,s,-s)}(e),function(){const t=document.createElement("canvas");t.width=s,t.height=s;const e=t.getContext("2d"),n=i.scale.value/100;e.drawImage(d,a.value,o.value,d.width*n,d.height*n),e.globalCompositeOperation="destination-in",e.beginPath(),e.arc(250,250,170,0,2*Math.PI),e.closePath(),e.fill(),u.drawImage(t,0,0,500,500)}();const n=s/2;let l="#MIL2CIV AVAILABLE "+i.text.value||0;m(l)&&(l=l.split("").reverse().join("")),function(t,e,o,a,n){t.fillStyle=i.textColor.value,t.save(),t.translate(o,a);const l=t.measureText(e).width,r=i.textOffset.value/100,s=(p*l+r)*Math.PI;t.rotate(s);const c=.86*n,u=Math.PI*-p;for(const[o,a]of e.split("").entries()){const e=u*t.measureText(a).width;o&&t.rotate(e),t.save(),t.translate(0,c),t.fillText(a,0,0),t.restore(),t.rotate(e)}t.restore()}(u,l,s/2,s/2,n)}const p=85e-5;const g=new FileReader;function v(t){o.value=parseInt(o.value)+t}function w(t){a.value=parseInt(a.value)+t}function x(t){i.scale.value=parseInt(i.scale.value)+t}function C(t){const e=new URLSearchParams(window.location.search);e.set(t.target.id,t.target.value),history.pushState(null,"","?"+e.toString()),h()}e.onchange=function(){const t=e.files[0];t&&(g.onload=()=>{d.src=g.result},g.readAsDataURL(t))},n.addEventListener("keydown",(t=>{"input"!==t.target.localName&&("ArrowUp"===t.code&&(t.metaKey||t.ctrlKey?x(1):v(-2),t.preventDefault()),"ArrowDown"===t.code&&(t.metaKey||t.ctrlKey?x(-1):v(2),t.preventDefault()),"ArrowLeft"===t.code&&w(-2),"ArrowRight"===t.code&&w(2),h())})),o.oninput=C,a.oninput=C,i.scale.oninput=C,i.labelBackground.oninput=C,i.frameColor1.oninput=C,i.frameColor2.oninput=C,i.text.oninput=C,i.textOffset.oninput=C,i.textColor.oninput=C,document.fonts.onloadingdone=h,r.onclick=function(){const t=document.createElement("a");t.href=l.toDataURL("image/jpg"),t.download="linked-profile-frame.jpg",document.body.appendChild(t),t.click(),document.body.removeChild(t),globalThis.Toastify({text:"Saved to downloads",duration:4e3,close:!0,gravity:"bottom",position:"center",className:"toastify-success"}).showToast()},i.text.value=(new Date).getMonth()+1+"/"+(new Date).getFullYear().toString().slice(-2),function(){const e=new URLSearchParams(window.location.search);for(const[o,a]of e){const e=t(`input#${o}`);e&&(e.value=a)}}()})();